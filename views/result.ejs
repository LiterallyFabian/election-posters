<!DOCTYPE html>
<html>
<head>
    <title><%= title %></title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel='stylesheet' href='/stylesheets/style.css'/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Livvic:400&display=swap" rel="stylesheet">
    <script type="text/javascript" src="../javascripts/result.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
</head>
<body>
<div id="content" class="container">
    <h1><%= title %></h1>
    <i>Quiz taget <%= new Date(data.date).toDateString() %></i>
    <hr>

    <%
    let votes = JSON.parse(data.votes);
    let result = [];
    const parties = [{
        id: "s",
        name: "Socialdemokraterna"
    }, {
        id: "m",
        name: "Moderaterna"
    }, {
        id: "c",
        name: "Centerpartiet"
    }, {
        id: "l",
        name: "Liberalerna"
    }, {
        id: "kd",
        name: "Kristdemokraterna"
    }, {
        id: "v",
        name: "VÃ¤nsterpartiet"
    }, {
        id: "mp",
        name: "MiljÃ¶partiet"
    }, {
        id: "sd",
        name: "Sverigedemokraterna"
    }];


    for (let i = 0; i < parties.length; i++) {
        result.push({
            party: parties[i],
            yesVotes: 0,
            noVotes: 0,
            neutralVotes: 0,
            posters: []
        });
    }

    for (let i = 0; i < votes.length; i++) {
        let vote = votes[i];
        let party = vote.poster.id;
        let agree = vote.agree;
        let partyIndex = result.findIndex(p => p.party.id === party);

        console.log("s")

        if (agree === 1) {
            result[partyIndex].yesVotes++;
        } else if (agree === -1) {
            result[partyIndex].noVotes++;
        } else {
            result[partyIndex].neutralVotes++;
        }
    }

    // sort res by yesVotes

    result.sort((a, b) => {
        return b.yesVotes - a.yesVotes;
    });

    console.log(result);
    %>

    <% result.forEach(party => {
        let yesPercent = Math.round(party.yesVotes / (party.yesVotes + party.noVotes + party.neutralVotes) * 100);
        let noPercent = Math.round(party.noVotes / (party.yesVotes + party.noVotes + party.neutralVotes) * 100);
        let neutralPercent = Math.round(party.neutralVotes / (party.yesVotes + party.noVotes + party.neutralVotes) * 100);

        yesPercent = isNaN(yesPercent) ? 0 : yesPercent;
        noPercent = isNaN(noPercent) ? 0 : noPercent;
        neutralPercent = isNaN(neutralPercent) ? 0 : neutralPercent;
    %>

    <div class="row">
        <div class="col-2">
            <img src="../images/logo-<%= party.party.id %>.jpg" alt="logo" width="100px" height="100px">
            <p><%= party.name %></p>
        </div>
        <div class="col-6">
            <h2><%= yesPercent %>% <%= party.party.name %></h2>
            <div class="d-flex">
                <div style="width: <%= yesPercent %>%; height: 30px; background-color: green;"></div>
                <div style="width: <%= noPercent %>%; height: 30px; background-color: gray;"></div>
                <div style="width: <%= neutralPercent %>%; height: 30px; background-color: red;"></div>
            </div>
            <i><b><%= party.yesVotes %></b> ja,
                <b><%= party.noVotes %></b> nej,
                <b><%= party.neutralVotes %></b> skippade</i>
        </div>
    </div>

    <% }); %>

</div>


<script>

</script>
</body>
</html>
